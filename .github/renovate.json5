{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  extends: ["github>camunda/infraex-common-config:default.json5"],
  "dockerfile": {
    "enabled": true,
    "managerFilePatterns": [
      '**/Dockerfile*',
    ],
  },
  "helm-values": {
    "enabled": true,
    "pinDigests": true,
    "managerFilePatterns": [
      '/(^|/)bases\\.ya?ml$/',
    ],
  },
  "separateMajorMinor": true,
  "packageRules": [
    {
      "matchManagers": ["dockerfile"],
      "groupName": "new major keycloak available",
      "groupSlug": "new-major-keycloak",
      "matchDatasources": ["docker"],
      "matchFileNames": [".watch-latest/Dockerfile*"],
      "matchUpdateTypes": ["major"],
      "enabled": true,
      "addLabels": ["dependencies", "docker", "hold"],
    },
    {
      "matchManagers": ["helm-values"],
      "groupName": "all non-major keycloak",
      "groupSlug": "all-non-major-keycloak",
      "matchDatasources": ["docker"],
      "matchFileNames": ["keycloak-*/bases.yml"],
      "enabled": true,
      "addLabels": ["dependencies", "docker"],
      "matchUpdateTypes": ["minor", "patch", "pin", "digest"],
    },
    {
      "matchManagers": ["helm-values"],
      "matchDatasources": ["docker"],
      "matchFileNames": ["keycloak-*/bases.yml"],
      "matchUpdateTypes": ["major"],
      "enabled": false,
    },
    // Quay images use X.Y.Z-N tags where -N is a build number, not a compatibility string.
    // Without custom versioning, Renovate treats -0 and -1 as different compatibility groups
    // and won't update across them (e.g. 26.3.2-1 â†’ 26.5.4-0).
    {
      "matchManagers": ["helm-values"],
      "matchPackageNames": ["quay.io/keycloak/keycloak"],
      "matchFileNames": ["keycloak-*/bases.yml"],
      "versioning": "regex:^(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)(-(?<build>\\d+))?$",
    },
    // this applies the same mechanism but to Dockerfile (e.g. identity which uses latest)
    {
      "matchManagers": ["dockerfile"],
      "groupName": "all non-major keycloak",
      "groupSlug": "all-non-major-keycloak",
      "matchDatasources": ["docker"],
      "matchFileNames": ["keycloak-*/Dockerfile"],
      "versioning": "regex:^(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)(:?-(?<compatibility>.+)(?<build>\\d+)-r(?<revision>\\d+))?$",
      "enabled": true,
      "addLabels": ["dependencies", "docker"],
    },
    {
      "matchManagers": ["dockerfile"],
      "matchDatasources": ["docker"],
      "matchFileNames": ["keycloak-*/Dockerfile"],
      "matchUpdateTypes": ["major"],
      "enabled": false,
    },
  ],
  hostRules: [
    {
      hostType: 'docker',
      matchHost: 'https://registry.camunda.cloud',
      username: '{{ secrets.INFRAEX_HARBOR_REGISTRY_USERNAME }}',
      password: '{{ secrets.INFRAEX_HARBOR_REGISTRY_PASSWORD }}',
    },
  ],
}
